<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NT Trading OS</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#050810" />
  <style>
    :root {
      --bg: #050810;
      --bg-elevated: #0c111a;
      --card: #101726;
      --card-soft: #141b2a;
      --accent: #16a34a;
      --accent-soft: #16341f;
      --danger: #f97373;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2933;
      --chip: #111827;
      --tab-bg: #020617;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #062c1f 0, #050810 40%, #020617 100%);
      color: var(--text);
    }

    .app {
      min-height: 100vh;
      max-width: 480px;
      margin: 0 auto;
      padding: 1rem 1rem 2rem;
    }

    header {
      padding: 0.75rem 0 0.5rem;
    }

    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
    }

    h1 {
      font-size: 1.25rem;
      margin: 0;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin-top: 0.15rem;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .status-pill {
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      background: #022c22;
      color: #bbf7d0;
      font-size: 0.75rem;
      border: 1px solid #047857;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      white-space: nowrap;
    }

    .status-pill-dot {
      width: 0.4rem;
      height: 0.4rem;
      border-radius: 999px;
      background: #22c55e;
    }

    .tabs {
      margin-top: 0.9rem;
      display: flex;
      background: var(--tab-bg);
      border-radius: 999px;
      padding: 0.2rem;
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 0.78rem;
      padding: 0.45rem 0.3rem;
      border-radius: 999px;
      cursor: pointer;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, #065f46, #16a34a);
      color: white;
      box-shadow: 0 0 0 1px rgba(22, 163, 74, 0.4);
    }

    main {
      margin-top: 1rem;
    }

    .card {
      background: linear-gradient(135deg, #050816, #050816 50%, #020617 100%);
      border-radius: 1.1rem;
      padding: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: 0 22px 40px rgba(0, 0, 0, 0.6);
      margin-bottom: 0.9rem;
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .card-title {
      font-size: 0.8rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .chip {
      font-size: 0.73rem;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      background: #0b1120;
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e5e7eb;
    }

    .chip.accent {
      background: #022c22;
      border-color: #16a34a;
      color: #bbf7d0;
    }

    .chip.neutral {
      background: #020617;
      border-color: rgba(148, 163, 184, 0.4);
    }

    .chip.danger {
      background: #45121a;
      border-color: #f97373;
      color: #fecaca;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.65rem;
    }

    label {
      font-size: 0.73rem;
      color: var(--muted);
      display: block;
      margin-bottom: 0.2rem;
    }

    input,
    select {
      width: 100%;
      background: #020617;
      border-radius: 0.65rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 0.5rem 0.6rem;
      font-size: 0.85rem;
      color: var(--text);
      outline: none;
    }

    input:focus,
    select:focus {
      border-color: #16a34a;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
    }

    .btn-row {
      display: flex;
      gap: 0.6rem;
      margin-top: 0.6rem;
    }

    .btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      font-size: 0.8rem;
      padding: 0.55rem 0.7rem;
      cursor: pointer;
      font-weight: 500;
    }

    .btn-primary {
      background: linear-gradient(135deg, #16a34a, #22c55e);
      color: #022c22;
    }

    .btn-outline {
      background: transparent;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #e5e7eb;
    }

    .btn-danger {
      background: rgba(127, 29, 29, 0.9);
      color: #fee2e2;
    }

    .muted {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 0.45rem;
    }

    .kpi-row {
      display: flex;
      justify-content: space-between;
      gap: 0.6rem;
      font-size: 0.8rem;
      margin-top: 0.4rem;
    }

    .kpi-label {
      color: var(--muted);
      font-size: 0.72rem;
    }

    .kpi-value {
      font-weight: 600;
    }

    .kpi-value.green {
      color: #4ade80;
    }

    .kpi-value.red {
      color: #fecaca;
    }

    .flip-progress {
      margin-top: 0.35rem;
      font-size: 0.72rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .flip-bar {
      margin-top: 0.35rem;
      width: 100%;
      height: 0.45rem;
      background: #020617;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .flip-bar-inner {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #a7f3d0);
      width: 0%;
      transition: width 0.25s ease-out;
    }

    .section-divider {
      border-top: 1px dashed rgba(148, 163, 184, 0.3);
      margin: 0.7rem 0;
    }

    .badge {
      font-size: 0.68rem;
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      background: #020617;
      color: var(--muted);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    .badge.green {
      color: #bbf7d0;
      background: #022c22;
      border-color: #16a34a;
    }

    .badge.red {
      color: #fee2e2;
      background: #450a0a;
      border-color: #f97373;
    }

    .bet-log {
      margin-top: 0.6rem;
      border-radius: 0.8rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.28);
      max-height: 220px;
      overflow-y: auto;
    }

    .bet-row {
      padding: 0.4rem 0.65rem;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      font-size: 0.78rem;
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
    }

    .bet-row:last-child {
      border-bottom: none;
    }

    .bet-main {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .bet-line {
      display: flex;
      gap: 0.35rem;
      align-items: baseline;
    }

    .bet-amount {
      font-weight: 600;
    }

    .bet-profit {
      font-weight: 600;
      color: #4ade80;
    }

    .bet-profit.negative {
      color: #fecaca;
    }

    .bet-meta {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .bet-pill {
      align-self: center;
      font-size: 0.72rem;
      padding: 0.1rem 0.55rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: #020617;
    }

    .bet-pill.win {
      border-color: #16a34a;
      color: #bbf7d0;
      background: #022c22;
    }

    .bet-pill.loss {
      border-color: #f97373;
      color: #fecaca;
      background: #45121a;
    }

    .bet-pill.push {
      border-color: rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
      background: #020617;
    }

    .section-note {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 0.4rem;
    }

    .hidden {
      display: none !important;
    }

    .flip-alert {
      background: #052e16;
      border-radius: 0.8rem;
      border: 1px solid #16a34a;
      padding: 0.6rem 0.7rem;
      font-size: 0.78rem;
      margin-bottom: 0.8rem;
      display: flex;
      gap: 0.5rem;
    }

    .flip-alert-icon {
      font-size: 0.9rem;
    }

    .flip-alert-title {
      font-weight: 600;
      margin-bottom: 0.15rem;
      color: #bbf7d0;
    }

    .flip-alert-body {
      color: #86efac;
      font-size: 0.74rem;
    }

    /* Flip Engine tab */

    .milestone-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-top: 0.3rem;
    }

    .milestone-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      padding: 0.45rem 0.65rem;
      border-radius: 0.75rem;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.3);
      font-size: 0.75rem;
    }

    .milestone-left {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .milestone-label {
      font-weight: 500;
    }

    .milestone-tagline {
      color: var(--muted);
      font-size: 0.7rem;
    }

    .milestone-right {
      text-align: right;
      font-size: 0.74rem;
    }

    .milestone-profit {
      font-weight: 600;
      color: #4ade80;
    }

    .vault-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem;
      margin-top: 0.3rem;
    }

    .vault-label {
      font-size: 0.72rem;
      color: var(--muted);
    }

    .vault-total {
      margin-top: 0.45rem;
      font-size: 0.78rem;
      display: flex;
      justify-content: space-between;
      gap: 0.4rem;
    }

    .vault-hint {
      margin-top: 0.3rem;
      font-size: 0.7rem;
      color: var(--muted);
    }

    /* Cheat sheet modal */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.88);
      display: flex;
      align-items: flex-end;
      justify-content: center;
      z-index: 40;
    }

    @media (min-width: 480px) {
      .modal-backdrop {
        align-items: center;
      }
    }

    .modal {
      width: 100%;
      max-width: 480px;
      background: #020617;
      border-radius: 1.1rem 1.1rem 0 0;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 0.9rem 1rem 1rem;
      max-height: 80vh;
      overflow-y: auto;
    }

    @media (min-width: 480px) {
      .modal {
        border-radius: 1.1rem;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .modal-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .modal-close {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: transparent;
      color: var(--muted);
      font-size: 0.75rem;
      padding: 0.25rem 0.55rem;
      cursor: pointer;
    }

    .cheat-section-title {
      font-size: 0.78rem;
      color: #e5e7eb;
      margin-top: 0.4rem;
      margin-bottom: 0.15rem;
    }

    .cheat-list {
      list-style: none;
      padding-left: 0.9rem;
      margin: 0;
      font-size: 0.72rem;
      color: var(--muted);
    }

    .cheat-list li::before {
      content: "• ";
      margin-left: -0.9rem;
      margin-right: 0.3rem;
    }

    footer {
      margin-top: 0.8rem;
      font-size: 0.68rem;
      color: #6b7280;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-row">
        <div>
          <h1>NT Trading OS</h1>
          <div class="subtitle">10-Flip System · Live Edges · Bankroll Extraction</div>
        </div>
        <div class="status-pill">
          <span class="status-pill-dot"></span>
          <span>Locked in</span>
        </div>
      </div>
      <div class="tabs">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="journal">Bet Journal</button>
        <button class="tab-btn" data-tab="flip">Flip Engine</button>
      </div>
    </header>

    <main>
      <!-- DASHBOARD TAB -->
      <section id="tab-dashboard">
        <div id="flipAlert" class="flip-alert hidden">
          <div class="flip-alert-icon">⚡️</div>
          <div>
            <div class="flip-alert-title" id="flipAlertTitle"></div>
            <div class="flip-alert-body" id="flipAlertBody"></div>
          </div>
        </div>

        <div class="card">
          <div class="card-header-row">
            <div class="card-title">Bankroll · Session</div>
            <span id="sessionHeatChip" class="chip neutral">Neutral</span>
          </div>
          <div class="grid-2">
            <div>
              <label>Starting Bankroll</label>
              <input id="startingBankroll" type="number" inputmode="decimal" placeholder="e.g. 2000" />
              <div class="kpi-row">
                <span class="kpi-label">Risk / bet:</span>
                <span id="riskPerBetLabel" class="kpi-value">$0.00</span>
              </div>
            </div>
            <div>
              <label>Current Balance (Today)</label>
              <input id="currentBalance" type="number" inputmode="decimal" placeholder="Auto from P/L" />
              <div class="kpi-row">
                <span class="kpi-label">P/L:</span>
                <span id="plTodayLabel" class="kpi-value green">0.00% today</span>
              </div>
            </div>
          </div>

          <div class="grid-2" style="margin-top:0.55rem;">
            <div>
              <label>% Risk / Bet</label>
              <input id="riskPercent" type="number" inputmode="decimal" placeholder="e.g. 2.5" />
            </div>
            <div>
              <label>Max Loss % (Day)</label>
              <input id="maxLossPercent" type="number" inputmode="decimal" placeholder="e.g. 15" />
            </div>
          </div>

          <div class="grid-2" style="margin-top:0.55rem;">
            <div>
              <label>Starting Roll (tag)</label>
              <input id="startingRollTag" type="text" placeholder="e.g. 500" />
            </div>
            <div>
              <label>Session Tag</label>
              <input id="sessionTag" type="text" placeholder="Thanksgiving board, etc." />
            </div>
          </div>

          <div class="btn-row">
            <button id="lockSessionBtn" class="btn btn-primary">Lock in session</button>
            <button id="newDayBtn" class="btn btn-outline">New day</button>
          </div>
          <div class="muted">
            Rule of thumb: <span style="color:#4ade80;">green = press edges</span>,
            <span style="color:#fca5a5;">red = protect roll</span>. Heat meter responds to P/L vs loss limit.
          </div>
        </div>

        <div class="card">
          <div class="card-header-row">
            <div class="card-title">10-Flip System</div>
            <span id="flipStatusChip" class="chip neutral">Flip 0 / 10</span>
          </div>
          <div class="grid-2">
            <div>
              <label>Target flips</label>
              <input id="targetFlips" type="number" inputmode="decimal" value="10" />
            </div>
            <div>
              <label>Profit per flip ($)</label>
              <input id="profitPerFlip" type="number" inputmode="decimal" placeholder="e.g. 200" />
            </div>
          </div>
          <div class="flip-progress">
            <span id="flipProgressLabel">0 completed</span>
            <span id="flipProfitSummary">0 / 10 · $0 per flip</span>
          </div>
          <div class="flip-bar">
            <div id="flipBarInner" class="flip-bar-inner"></div>
          </div>
          <div class="btn-row">
            <button id="markFlipBtn" class="btn btn-primary">Mark flip complete</button>
            <button id="undoFlipBtn" class="btn btn-outline">Undo last flip</button>
          </div>
          <div class="muted">
            Use flips as <strong>extraction milestones</strong> — each flip is a pre-defined profit target.
            When flips <strong>2, 4, 6, 8, 10</strong> hit, consider withdrawing a piece of profits.
          </div>
        </div>

        <div class="card">
          <div class="card-header-row">
            <div class="card-title">Live Bet Input</div>
            <button id="cheatSheetBtn" class="badge">Cheat sheet</button>
          </div>
          <div class="grid-2">
            <div>
              <label>Stake ($)</label>
              <input id="stakeInput" type="number" inputmode="decimal" placeholder="50" />
            </div>
            <div>
              <label>Outcome</label>
              <select id="outcomeInput">
                <option value="Win">Win</option>
                <option value="Loss">Loss</option>
                <option value="Cashout">Cashout</option>
                <option value="Push">Push</option>
              </select>
            </div>
          </div>

          <div class="grid-2" style="margin-top:0.55rem;">
            <div>
              <label>Returned ($)</label>
              <input id="returnedInput" type="number" inputmode="decimal" placeholder="Return / cashout" />
            </div>
            <div>
              <label>Tag</label>
              <input id="tagInput" type="text" placeholder="1H ML, alt spread, etc." />
            </div>
          </div>

          <div class="btn-row">
            <button id="logBetBtn" class="btn btn-primary">Log bet</button>
            <button id="clearLogBtn" class="btn btn-danger">Clear log (today)</button>
          </div>
          <div class="section-note">
            Quick rules: <strong>single / 2-leg &gt; ladders &gt; hail marys</strong>.
            Cashouts count as realized profit. Use tags to track your best zones.
          </div>

          <div class="section-divider"></div>

          <div class="card-header-row" style="margin-bottom:0.35rem;">
            <div class="card-title">Day stats & log</div>
            <span id="sessionSummaryChip" class="badge">0 bets · —</span>
          </div>

          <div class="kpi-row">
            <div>
              <div class="kpi-label">Net P/L (today)</div>
              <div id="netPlLabel" class="kpi-value green">$0.00</div>
              <div id="netPlPerBetLabel" class="kpi-label">$0.00 / bet · 0 bets</div>
            </div>
            <div>
              <div class="kpi-label">Volume &amp; hit rate</div>
              <div id="hitRateLabel" class="kpi-value">0.0% hit rate</div>
              <div id="volumeLabel" class="kpi-label">$0.00 staked · $0.00 returned</div>
            </div>
          </div>

          <div class="kpi-row">
            <div>
              <div class="kpi-label">Return multiple</div>
              <div id="returnMultipleLabel" class="kpi-value">1.00x</div>
            </div>
            <div style="text-align:right;">
              <div class="kpi-label">Average stake</div>
              <div id="avgStakeLabel" class="kpi-value">$0.00</div>
            </div>
          </div>

          <div id="betLog" class="bet-log">
            <!-- Bet rows injected here -->
          </div>

          <div class="section-note">
            Use this as your <strong>truth mirror</strong>. Volume, hit rate, avg stake, and extraction
            tell you when to <strong>press</strong> vs <strong>shut it down</strong>.
          </div>
        </div>
      </section>

      <!-- JOURNAL TAB -->
      <section id="tab-journal" class="hidden">
        <div class="card">
          <div class="card-header-row">
            <div class="card-title">Bet Journal · Today</div>
            <span id="journalCountChip" class="badge">0 logged</span>
          </div>

          <div class="grid-2">
            <div>
              <div class="kpi-label">Wins</div>
              <div id="winsCountLabel" class="kpi-value green">0</div>
              <div id="winsNetLabel" class="kpi-label">$0.00 net</div>
              <div class="section-note">Cashouts counted as realized profit.</div>
            </div>
            <div>
              <div class="kpi-label">Losses</div>
              <div id="lossesCountLabel" class="kpi-value red">0</div>
              <div id="lossesNetLabel" class="kpi-label">$0.00 net</div>
              <div class="section-note">Push / neutral tracked separately.</div>
            </div>
          </div>

          <div class="grid-2" style="margin-top:0.4rem;">
            <div>
              <div class="kpi-label">Cashouts</div>
              <div id="cashoutsCountLabel" class="kpi-value">0</div>
              <div id="cashoutsNetLabel" class="kpi-label">$0.00 net</div>
            </div>
            <div>
              <div class="kpi-label">Push / neutral</div>
              <div id="pushCountLabel" class="kpi-value">0</div>
              <div id="pushNetLabel" class="kpi-label">$0.00 net</div>
            </div>
          </div>

          <div class="section-divider"></div>

          <div id="journalInsight" class="section-note">
            Log a few bets and this will start reflecting your strongest &amp; weakest zones.
          </div>

          <div class="section-note" style="margin-top:0.35rem;">
            Top tags by volume &amp; profit:
          </div>

          <div id="tagTable" class="bet-log" style="max-height:240px;">
            <!-- Tag rows injected here -->
          </div>
        </div>
      </section>

      <!-- FLIP ENGINE TAB -->
      <section id="tab-flip" class="hidden">
        <div class="card">
          <div class="card-header-row">
            <div class="card-title">Flip Engine · Milestones</div>
            <span id="flipEngineSummary" class="badge">Plan your exits</span>
          </div>

          <div class="grid-2">
            <div>
              <label>Target flips</label>
              <input id="feTargetFlips" type="number" inputmode="decimal" />
            </div>
            <div>
              <label>Profit per flip ($)</label>
              <input id="feProfitPerFlip" type="number" inputmode="decimal" />
            </div>
          </div>

          <div class="vault-total">
            <span class="vault-label">Total planned profit:</span>
            <span id="feTotalProfitLabel" class="kpi-value green">$0.00</span>
          </div>

          <div class="vault-hint">
            Think in <strong>milestones</strong> not dreams — when the target stack is hit, extraction is non-negotiable.
          </div>

          <div class="section-divider"></div>

          <div class="section-note">Flip milestones &amp; suggested extraction:</div>
          <div id="milestoneList" class="milestone-list">
            <!-- Milestones injected -->
          </div>
        </div>

        <div class="card">
          <div class="card-header-row">
            <div class="card-title">Bankroll Vaults</div>
            <span id="vaultStatusChip" class="badge">Draft mix</span>
          </div>

          <div class="vault-grid">
            <div>
              <div class="vault-label">Main trading roll</div>
              <input id="vaultMain" type="number" inputmode="decimal" placeholder="Core roll" />
            </div>
            <div>
              <div class="vault-label">Sportsbook balance</div>
              <input id="vaultSportsbook" type="number" inputmode="decimal" placeholder="On the apps" />
            </div>
            <div>
              <div class="vault-label">Profit vault</div>
              <input id="vaultProfit" type="number" inputmode="decimal" placeholder="Skimmed profits" />
            </div>
            <div>
              <div class="vault-label">Emergency vault</div>
              <input id="vaultEmergency" type="number" inputmode="decimal" placeholder="Touch last" />
            </div>
          </div>

          <div class="vault-total">
            <span class="vault-label">Total bankroll tracked:</span>
            <span id="vaultTotalLabel" class="kpi-value">$0.00</span>
          </div>

          <div id="vaultSuggestedMix" class="vault-hint">
            Save a mix and this will suggest a guideline split for future extractions.
          </div>

          <div class="btn-row">
            <button id="vaultSyncBtn" class="btn btn-outline">Sync from session</button>
            <button id="vaultSaveBtn" class="btn btn-primary">Save vault mix</button>
          </div>

          <div class="section-note">
            Philosophy: <strong>apps are for action</strong>, vaults are for storage. Extraction days move
            money from Sportsbook → Profit vault / Emergency vault, not the other way around.
          </div>
        </div>
      </section>
    </main>

    <!-- Cheat Sheet Modal -->
    <div id="cheatSheetBackdrop" class="modal-backdrop hidden">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Live Bet Cheat Sheet</div>
          <button id="closeCheatSheetBtn" class="modal-close">Done</button>
        </div>
        <div class="section-note">
          Use this as your in-game compass — not to chase, but to organize edge + discipline.
        </div>

        <div class="cheat-section-title">1. Bet selection hierarchy</div>
        <ul class="cheat-list">
          <li><strong>Singles</strong> first. If the edge is real, it doesn’t need friends.</li>
          <li><strong>2-leg parlays</strong> only when both legs are A-grade edges.</li>
          <li><strong>Ladders</strong> = press when you’re cooking, not when you’re cold.</li>
          <li><strong>Hail marys</strong> live at the <em>bottom</em> of priority, tiny stake only.</li>
        </ul>

        <div class="cheat-section-title">2. Sizing &amp; risk</div>
        <ul class="cheat-list">
          <li>Standard stake ≈ session % risk (2–3% of roll).</li>
          <li>Only increase stake when hit rate + read are aligned, not from emotion.</li>
          <li>Respect the daily max loss. Once tapped: session over.</li>
        </ul>

        <div class="cheat-section-title">3. Cashout &amp; extraction</div>
        <ul class="cheat-list">
          <li>Cashouts count as <strong>realized profit</strong> — log them accurately.</li>
          <li>On flip milestones (2, 4, 6, 8, 10) skim 30–50% of profits to vaults.</li>
          <li>Never redeploy emergency or profit vault back into reckless ladders.</li>
        </ul>

        <div class="cheat-section-title">4. Tilt rules</div>
        <ul class="cheat-list">
          <li>Two bad beats in a row → shrink size or pause 1–2 bets.</li>
          <li>If you find yourself chasing a loss, freeze and log the emotion instead.</li>
          <li>Remember: you’re running a <strong>business</strong>, not feeding a habit.</li>
        </ul>
      </div>
    </div>

    <footer>NT Trading OS · Saved locally on this device.</footer>
  </div>

  <script>
    const stateKey = "nt_trading_os_v1";

    const defaultState = {
      startingBankroll: 0,
      riskPercent: 0,
      maxLossPercent: 0,
      startingRollTag: "",
      sessionTag: "",
      targetFlips: 10,
      profitPerFlip: 0,
      flipsCompleted: 0,
      bets: [],
      vaults: {
        main: 0,
        sportsbook: 0,
        profit: 0,
        emergency: 0
      }
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(stateKey);
        if (!raw) return { ...defaultState };
        const parsed = JSON.parse(raw);
        return { ...defaultState, ...parsed };
      } catch {
        return { ...defaultState };
      }
    }

    function saveState() {
      localStorage.setItem(stateKey, JSON.stringify(state));
    }

    let state = loadState();

    // Elements
    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabDashboard = document.getElementById("tab-dashboard");
    const tabJournal = document.getElementById("tab-journal");
    const tabFlip = document.getElementById("tab-flip");

    const startingBankrollInput = document.getElementById("startingBankroll");
    const currentBalanceInput = document.getElementById("currentBalance");
    const riskPercentInput = document.getElementById("riskPercent");
    const maxLossPercentInput = document.getElementById("maxLossPercent");
    const startingRollTagInput = document.getElementById("startingRollTag");
    const sessionTagInput = document.getElementById("sessionTag");
    const riskPerBetLabel = document.getElementById("riskPerBetLabel");
    const plTodayLabel = document.getElementById("plTodayLabel");
    const sessionHeatChip = document.getElementById("sessionHeatChip");
    const lockSessionBtn = document.getElementById("lockSessionBtn");
    const newDayBtn = document.getElementById("newDayBtn");

    const targetFlipsInput = document.getElementById("targetFlips");
    const profitPerFlipInput = document.getElementById("profitPerFlip");
    const flipStatusChip = document.getElementById("flipStatusChip");
    const flipProgressLabel = document.getElementById("flipProgressLabel");
    const flipProfitSummary = document.getElementById("flipProfitSummary");
    const flipBarInner = document.getElementById("flipBarInner");
    const markFlipBtn = document.getElementById("markFlipBtn");
    const undoFlipBtn = document.getElementById("undoFlipBtn");
    const flipAlert = document.getElementById("flipAlert");
    const flipAlertTitle = document.getElementById("flipAlertTitle");
    const flipAlertBody = document.getElementById("flipAlertBody");

    const stakeInput = document.getElementById("stakeInput");
    const outcomeInput = document.getElementById("outcomeInput");
    const returnedInput = document.getElementById("returnedInput");
    const tagInput = document.getElementById("tagInput");
    const logBetBtn = document.getElementById("logBetBtn");
    const clearLogBtn = document.getElementById("clearLogBtn");
    const netPlLabel = document.getElementById("netPlLabel");
    const netPlPerBetLabel = document.getElementById("netPlPerBetLabel");
    const hitRateLabel = document.getElementById("hitRateLabel");
    const volumeLabel = document.getElementById("volumeLabel");
    const returnMultipleLabel = document.getElementById("returnMultipleLabel");
    const avgStakeLabel = document.getElementById("avgStakeLabel");
    const betLog = document.getElementById("betLog");
    const sessionSummaryChip = document.getElementById("sessionSummaryChip");

    const journalCountChip = document.getElementById("journalCountChip");
    const winsCountLabel = document.getElementById("winsCountLabel");
    const winsNetLabel = document.getElementById("winsNetLabel");
    const lossesCountLabel = document.getElementById("lossesCountLabel");
    const lossesNetLabel = document.getElementById("lossesNetLabel");
    const cashoutsCountLabel = document.getElementById("cashoutsCountLabel");
    const cashoutsNetLabel = document.getElementById("cashoutsNetLabel");
    const pushCountLabel = document.getElementById("pushCountLabel");
    const pushNetLabel = document.getElementById("pushNetLabel");
    const journalInsight = document.getElementById("journalInsight");
    const tagTable = document.getElementById("tagTable");

    const feTargetFlipsInput = document.getElementById("feTargetFlips");
    const feProfitPerFlipInput = document.getElementById("feProfitPerFlip");
    const feTotalProfitLabel = document.getElementById("feTotalProfitLabel");
    const milestoneList = document.getElementById("milestoneList");
    const flipEngineSummary = document.getElementById("flipEngineSummary");

    const vaultMainInput = document.getElementById("vaultMain");
    const vaultSportsbookInput = document.getElementById("vaultSportsbook");
    const vaultProfitInput = document.getElementById("vaultProfit");
    const vaultEmergencyInput = document.getElementById("vaultEmergency");
    const vaultTotalLabel = document.getElementById("vaultTotalLabel");
    const vaultSuggestedMix = document.getElementById("vaultSuggestedMix");
    const vaultStatusChip = document.getElementById("vaultStatusChip");
    const vaultSyncBtn = document.getElementById("vaultSyncBtn");
    const vaultSaveBtn = document.getElementById("vaultSaveBtn");

    const cheatSheetBtn = document.getElementById("cheatSheetBtn");
    const cheatSheetBackdrop = document.getElementById("cheatSheetBackdrop");
    const closeCheatSheetBtn = document.getElementById("closeCheatSheetBtn");

    // Utilities
    function fmtMoney(num) {
      if (!isFinite(num)) num = 0;
      return "$" + num.toFixed(2);
    }

    function fmtPercent(num) {
      if (!isFinite(num)) num = 0;
      return num.toFixed(1) + "%";
    }

    function nowTimeString() {
      const d = new Date();
      const h = d.getHours();
      const m = d.getMinutes().toString().padStart(2, "0");
      const hour12 = ((h + 11) % 12) + 1;
      const ampm = h >= 12 ? "PM" : "AM";
      return `${hour12}:${m} ${ampm}`;
    }

    // Tab switching
    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        tabButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;
        tabDashboard.classList.toggle("hidden", tab !== "dashboard");
        tabJournal.classList.toggle("hidden", tab !== "journal");
        tabFlip.classList.toggle("hidden", tab !== "flip");
      });
    });

    // Session + bankroll
    function updateSessionFromInputs() {
      state.startingBankroll = parseFloat(startingBankrollInput.value) || 0;
      state.riskPercent = parseFloat(riskPercentInput.value) || 0;
      state.maxLossPercent = parseFloat(maxLossPercentInput.value) || 0;
      state.startingRollTag = startingRollTagInput.value || "";
      state.sessionTag = sessionTagInput.value || "";
    }

    function computeStats() {
      const bets = state.bets;
      let totalStaked = 0;
      let totalReturned = 0;
      let wins = 0;
      let losses = 0;
      let cashouts = 0;
      let pushes = 0;
      let winNet = 0;
      let lossNet = 0;
      let cashoutNet = 0;
      let pushNet = 0;

      bets.forEach(b => {
        const stake = b.stake;
        const ret = b.returned;
        const net = ret - stake;
        totalStaked += stake;
        totalReturned += ret;

        if (b.outcome === "Win") {
          wins++;
          winNet += net;
        } else if (b.outcome === "Loss") {
          losses++;
          lossNet += net;
        } else if (b.outcome === "Cashout") {
          cashouts++;
          cashoutNet += net;
        } else if (b.outcome === "Push") {
          pushes++;
          pushNet += net;
        }
      });

      const count = bets.length;
      const netPl = totalReturned - totalStaked;
      const hitRate = count ? (wins / count) * 100 : 0;
      const avgStake = count ? totalStaked / count : 0;
      const multiple = totalStaked ? totalReturned / totalStaked : 1;

      return {
        totalStaked,
        totalReturned,
        netPl,
        count,
        hitRate,
        avgStake,
        multiple,
        wins,
        losses,
        cashouts,
        pushes,
        winNet,
        lossNet,
        cashoutNet,
        pushNet
      };
    }

    function updateDashboardStats() {
      const stats = computeStats();
      const {
        totalStaked,
        totalReturned,
        netPl,
        count,
        hitRate,
        avgStake,
        multiple
      } = stats;

      netPlLabel.textContent = fmtMoney(netPl);
      netPlLabel.classList.toggle("green", netPl >= 0);
      netPlLabel.classList.toggle("red", netPl < 0);

      netPlPerBetLabel.textContent = `${fmtMoney(count ? netPl / count : 0)} / bet · ${count} bets`;
      hitRateLabel.textContent = `${fmtPercent(hitRate)} hit rate`;
      volumeLabel.textContent = `${fmtMoney(totalStaked)} staked · ${fmtMoney(totalReturned)} returned`;
      returnMultipleLabel.textContent = multiple.toFixed(2) + "x";
      avgStakeLabel.textContent = fmtMoney(avgStake);
      sessionSummaryChip.textContent = `${count} bets · ${state.sessionTag || "No tag"}`;

      // Current balance & P/L %
      const starting = state.startingBankroll || 0;
      const current = starting + netPl;
      currentBalanceInput.value = current ? current.toFixed(2) : "";

      let plPct = 0;
      if (starting > 0) plPct = (netPl / starting) * 100;
      plTodayLabel.textContent = `${plPct.toFixed(2)}% today`;
      plTodayLabel.classList.toggle("green", plPct >= 0);
      plTodayLabel.classList.toggle("red", plPct < 0);

      const riskPer = state.riskPercent || 0;
      const riskPerBet = starting * (riskPer / 100);
      riskPerBetLabel.textContent = fmtMoney(riskPerBet);

      // Heat meter
      const lossLimit = state.maxLossPercent || 0;
      let mode = "neutral";
      let label = "Neutral";
      if (starting > 0 && lossLimit > 0) {
        const lossPct = -plPct;
        if (plPct >= lossLimit * 0.4) {
          mode = "accent";
          label = "Cooking · Press edges";
        } else if (lossPct >= lossLimit * 0.6) {
          mode = "danger";
          label = "Danger · Protect roll";
        }
      }
      sessionHeatChip.textContent = label;
      sessionHeatChip.className = "chip " + (mode === "accent" ? "accent" : mode === "danger" ? "danger" : "neutral");

      renderBetLog();
      saveState();
    }

    function renderBetLog() {
      betLog.innerHTML = "";
      if (!state.bets.length) {
        const empty = document.createElement("div");
        empty.className = "section-note";
        empty.style.padding = "0.5rem 0.75rem 0.7rem";
        empty.textContent = "No bets logged yet. Use this area as your running tape for the day.";
        betLog.appendChild(empty);
        return;
      }
      state.bets.slice().reverse().forEach(b => {
        const row = document.createElement("div");
        row.className = "bet-row";

        const main = document.createElement("div");
        main.className = "bet-main";

        const line = document.createElement("div");
        line.className = "bet-line";
        const amt = document.createElement("span");
        amt.className = "bet-amount";
        amt.textContent = `${fmtMoney(b.stake)} → ${fmtMoney(b.returned)}`;
        const profit = document.createElement("span");
        const net = b.returned - b.stake;
        profit.className = "bet-profit" + (net < 0 ? " negative" : "");
        profit.textContent = (net >= 0 ? "+" : "") + fmtMoney(net).replace("$", "");
        line.appendChild(amt);
        line.appendChild(profit);

        const meta = document.createElement("div");
        meta.className = "bet-meta";
        const tagText = b.tag ? ` · ${b.tag}` : "";
        meta.textContent = `${b.time} · ${b.outcome}${tagText}`;

        main.appendChild(line);
        main.appendChild(meta);

        const pill = document.createElement("div");
        pill.className = "bet-pill";
        if (b.outcome === "Win") pill.classList.add("win");
        else if (b.outcome === "Loss") pill.classList.add("loss");
        else pill.classList.add("push");
        pill.textContent = b.outcome;

        row.appendChild(main);
        row.appendChild(pill);
        betLog.appendChild(row);
      });
    }

    function updateFlipsUI() {
      const target = state.targetFlips || 0;
      const completed = state.flipsCompleted || 0;
      const perFlip = state.profitPerFlip || 0;

      flipProgressLabel.textContent = `${completed} completed`;
      flipProfitSummary.textContent = `${target || 0} / ${target || 10} · ${fmtMoney(perFlip)} per flip`;
      const pct = target > 0 ? Math.min(100, (completed / target) * 100) : 0;
      flipBarInner.style.width = pct + "%";
      flipStatusChip.textContent = `Flip ${completed} / ${target || 10}`;
      flipStatusChip.className = "chip " + (completed ? "accent" : "neutral");

      // Flip Engine tab mirror
      feTargetFlipsInput.value = target || "";
      feProfitPerFlipInput.value = perFlip || "";
      updateFlipEngineMilestones();

      saveState();
    }

    function maybeShowFlipAlert() {
      const milestones = [2, 4, 6, 8, 10];
      const completed = state.flipsCompleted || 0;
      if (!milestones.includes(completed)) {
        flipAlert.classList.add("hidden");
        return;
      }
      const profitTarget = (state.profitPerFlip || 0) * completed;
      const skimLow = profitTarget * 0.3;
      const skimHigh = profitTarget * 0.5;

      flipAlertTitle.textContent = `Flip ${completed} milestone hit`;
      flipAlertBody.textContent =
        `Est. profit stack ≈ ${fmtMoney(profitTarget)}. Consider extracting ${fmtMoney(
          skimLow
        )} – ${fmtMoney(skimHigh)} into your Profit / Emergency vaults.`;
      flipAlert.classList.remove("hidden");
    }

    // Journal
    function updateJournal() {
      const stats = computeStats();
      const {
        netPl,
        count,
        wins,
        losses,
        cashouts,
        pushes,
        winNet,
        lossNet,
        cashoutNet,
        pushNet
      } = stats;

      journalCountChip.textContent = `${count} logged`;

      winsCountLabel.textContent = wins;
      winsNetLabel.textContent = fmtMoney(winNet) + " net";

      lossesCountLabel.textContent = losses;
      lossesNetLabel.textContent = fmtMoney(lossNet) + " net";

      cashoutsCountLabel.textContent = cashouts;
      cashoutsNetLabel.textContent = fmtMoney(cashoutNet) + " net";

      pushCountLabel.textContent = pushes;
      pushNetLabel.textContent = fmtMoney(pushNet) + " net";

      if (!count) {
        journalInsight.textContent =
          "Log a few bets and this will start reflecting your strongest & weakest zones.";
      } else {
        const tagStats = buildTagStats();
        let bestTag = null;
        let worstTag = null;
        Object.values(tagStats).forEach(t => {
          if (bestTag === null || t.net > bestTag.net) bestTag = t;
          if (worstTag === null || t.net < worstTag.net) worstTag = t;
        });

        if (bestTag && worstTag) {
          journalInsight.textContent = `Strongest so far: ${bestTag.name} (${fmtMoney(
            bestTag.net
          )} net). Leak to watch: ${worstTag.name} (${fmtMoney(worstTag.net)} net).`;
        } else {
          journalInsight.textContent = "Keep logging – patterns will surface after more volume.";
        }
        renderTagTable(tagStats);
      }

      saveState();
    }

    function buildTagStats() {
      const tagMap = {};
      state.bets.forEach(b => {
        const name = (b.tag && b.tag.trim()) || "untagged";
        if (!tagMap[name]) {
          tagMap[name] = { name, count: 0, staked: 0, returned: 0, net: 0 };
        }
        const t = tagMap[name];
        t.count += 1;
        t.staked += b.stake;
        t.returned += b.returned;
        t.net += b.returned - b.stake;
      });
      return tagMap;
    }

    function renderTagTable(tagStats) {
      tagTable.innerHTML = "";
      const names = Object.keys(tagStats);
      if (!names.length) {
        const empty = document.createElement("div");
        empty.className = "section-note";
        empty.style.padding = "0.5rem 0.75rem 0.7rem";
        empty.textContent = "No tags yet. Use the TAG field when you log bets.";
        tagTable.appendChild(empty);
        return;
      }
      names
        .sort((a, b) => tagStats[b].net - tagStats[a].net)
        .forEach(name => {
          const t = tagStats[name];
          const row = document.createElement("div");
          row.className = "bet-row";

          const main = document.createElement("div");
          main.className = "bet-main";

          const label = document.createElement("div");
          label.className = "bet-amount";
          label.textContent = name;

          const meta = document.createElement("div");
          meta.className = "bet-meta";
          meta.textContent = `${t.count} bets · ${fmtMoney(t.staked)} staked`;

          main.appendChild(label);
          main.appendChild(meta);

          const right = document.createElement("div");
          right.className = "bet-pill";
          right.textContent = fmtMoney(t.net) + " net";
          if (t.net > 0) right.classList.add("win");
          else if (t.net < 0) right.classList.add("loss");

          row.appendChild(main);
          row.appendChild(right);
          tagTable.appendChild(row);
        });
    }

    // Flip Engine
    function updateFlipEngineMilestones() {
      const target = state.targetFlips || 0;
      const perFlip = state.profitPerFlip || 0;
      const total = target * perFlip;
      feTotalProfitLabel.textContent = fmtMoney(total);
      flipEngineSummary.textContent = target && perFlip
        ? `${target} flips · ${fmtMoney(perFlip)} / flip`
        : "Plan your exits";

      milestoneList.innerHTML = "";

      if (!target || !perFlip) {
        const empty = document.createElement("div");
        empty.className = "section-note";
        empty.textContent = "Set a target flip count and profit per flip to see milestone guidance.";
        milestoneList.appendChild(empty);
        return;
      }

      const baseMilestones = [2, 4, 6, 8, target];
      const milestones = Array.from(new Set(baseMilestones.filter(m => m > 0 && m <= target))).sort(
        (a, b) => a - b
      );

      milestones.forEach(m => {
        const cumProfit = m * perFlip;
        const skimLow = cumProfit * 0.3;
        const skimHigh = cumProfit * 0.5;

        const row = document.createElement("div");
        row.className = "milestone-row";

        const left = document.createElement("div");
        left.className = "milestone-left";
        const label = document.createElement("div");
        label.className = "milestone-label";
        label.textContent = `Flip ${m}`;
        const tagline = document.createElement("div");
        tagline.className = "milestone-tagline";
        tagline.textContent = m === target ? "Non-negotiable extraction." : "Pressure release valve.";
        left.appendChild(label);
        left.appendChild(tagline);

        const right = document.createElement("div");
        right.className = "milestone-right";
        const profitEl = document.createElement("div");
        profitEl.className = "milestone-profit";
        profitEl.textContent = fmtMoney(cumProfit);
        const skimEl = document.createElement("div");
        skimEl.textContent = `Skim ${fmtMoney(skimLow)} – ${fmtMoney(skimHigh)}`;
        right.appendChild(profitEl);
        right.appendChild(skimEl);

        row.appendChild(left);
        row.appendChild(right);
        milestoneList.appendChild(row);
      });
    }

    // Vaults
    function updateVaultUIFromState() {
      const v = state.vaults || defaultState.vaults;
      vaultMainInput.value = v.main || "";
      vaultSportsbookInput.value = v.sportsbook || "";
      vaultProfitInput.value = v.profit || "";
      vaultEmergencyInput.value = v.emergency || "";
      updateVaultSummary();
    }

    function updateVaultSummary() {
      const main = parseFloat(vaultMainInput.value) || 0;
      const sb = parseFloat(vaultSportsbookInput.value) || 0;
      const profit = parseFloat(vaultProfitInput.value) || 0;
      const em = parseFloat(vaultEmergencyInput.value) || 0;
      const total = main + sb + profit + em;
      vaultTotalLabel.textContent = fmtMoney(total);

      if (!total) {
        vaultSuggestedMix.textContent =
          "Save a mix and this will suggest a guideline split for future extractions.";
        vaultStatusChip.textContent = "Draft mix";
        return;
      }

      const pct = val => ((val / total) * 100).toFixed(1) + "%";
      vaultSuggestedMix.textContent =
        `Current split → Main: ${pct(main)} · Sportsbook: ${pct(sb)} · Profit: ${pct(
          profit
        )} · Emergency: ${pct(em)}. ` +
        "On big extraction days, favor topping up Profit & Emergency first.";

      vaultStatusChip.textContent = "Mix saved";
    }

    // Cheat sheet modal
    function openCheatSheet() {
      cheatSheetBackdrop.classList.remove("hidden");
    }
    function closeCheatSheet() {
      cheatSheetBackdrop.classList.add("hidden");
    }

    // Event listeners
    lockSessionBtn.addEventListener("click", () => {
      updateSessionFromInputs();
      updateDashboardStats();
    });

    newDayBtn.addEventListener("click", () => {
      if (!confirm("Start a fresh day? This will clear today's bets and flip count.")) return;
      state.bets = [];
      state.flipsCompleted = 0;
      saveState();
      updateDashboardStats();
      updateFlipsUI();
      updateJournal();
      flipAlert.classList.add("hidden");
    });

    [startingBankrollInput, riskPercentInput, maxLossPercentInput, startingRollTagInput, sessionTagInput].forEach(
      el => {
        el.addEventListener("change", () => {
          updateSessionFromInputs();
          updateDashboardStats();
        });
      }
    );

    targetFlipsInput.addEventListener("change", () => {
      state.targetFlips = parseInt(targetFlipsInput.value, 10) || 0;
      updateFlipsUI();
    });
    profitPerFlipInput.addEventListener("change", () => {
      state.profitPerFlip = parseFloat(profitPerFlipInput.value) || 0;
      updateFlipsUI();
    });

    markFlipBtn.addEventListener("click", () => {
      const target = state.targetFlips || 0;
      if (!target) return;
      state.flipsCompleted = Math.min(target, (state.flipsCompleted || 0) + 1);
      updateFlipsUI();
      maybeShowFlipAlert();
    });

    undoFlipBtn.addEventListener("click", () => {
      state.flipsCompleted = Math.max(0, (state.flipsCompleted || 0) - 1);
      updateFlipsUI();
      maybeShowFlipAlert();
    });

    logBetBtn.addEventListener("click", () => {
      const stake = parseFloat(stakeInput.value) || 0;
      if (!stake) {
        alert("Enter a stake amount first.");
        return;
      }
      const outcome = outcomeInput.value;
      let returned = parseFloat(returnedInput.value);
      if (!isFinite(returned)) {
        if (outcome === "Win" || outcome === "Push") returned = stake;
        else if (outcome === "Loss") returned = 0;
        else returned = stake;
      }
      const tag = tagInput.value.trim();
      state.bets.push({
        stake,
        outcome,
        returned,
        tag,
        time: nowTimeString()
      });
      stakeInput.value = "";
      returnedInput.value = "";
      tagInput.value = "";
      updateDashboardStats();
      updateJournal();
    });

    clearLogBtn.addEventListener("click", () => {
      if (!confirm("Clear today's bet log? This does not change your bankroll settings.")) return;
      state.bets = [];
      state.flipsCompleted = 0;
      saveState();
      updateDashboardStats();
      updateJournal();
      updateFlipsUI();
      flipAlert.classList.add("hidden");
    });

    feTargetFlipsInput.addEventListener("change", () => {
      state.targetFlips = parseInt(feTargetFlipsInput.value, 10) || 0;
      targetFlipsInput.value = state.targetFlips || "";
      updateFlipsUI();
    });
    feProfitPerFlipInput.addEventListener("change", () => {
      state.profitPerFlip = parseFloat(feProfitPerFlipInput.value) || 0;
      profitPerFlipInput.value = state.profitPerFlip || "";
      updateFlipsUI();
    });

    vaultSyncBtn.addEventListener("click", () => {
      const stats = computeStats();
      const netPl = stats.netPl;
      const starting = state.startingBankroll || 0;
      const current = starting + netPl;

      vaultMainInput.value = starting ? starting.toFixed(2) : "";
      vaultSportsbookInput.value = current ? current.toFixed(2) : "";
      updateVaultSummary();
    });

    vaultSaveBtn.addEventListener("click", () => {
      state.vaults = {
        main: parseFloat(vaultMainInput.value) || 0,
        sportsbook: parseFloat(vaultSportsbookInput.value) || 0,
        profit: parseFloat(vaultProfitInput.value) || 0,
        emergency: parseFloat(vaultEmergencyInput.value) || 0
      };
      saveState();
      updateVaultSummary();
      alert("Vault mix saved to this device.");
    });

    [vaultMainInput, vaultSportsbookInput, vaultProfitInput, vaultEmergencyInput].forEach(el => {
      el.addEventListener("change", updateVaultSummary);
    });

    cheatSheetBtn.addEventListener("click", openCheatSheet);
    closeCheatSheetBtn.addEventListener("click", closeCheatSheet);
    cheatSheetBackdrop.addEventListener("click", e => {
      if (e.target === cheatSheetBackdrop) closeCheatSheet();
    });

    // Init
    function initFromState() {
      startingBankrollInput.value = state.startingBankroll || "";
      riskPercentInput.value = state.riskPercent || "";
      maxLossPercentInput.value = state.maxLossPercent || "";
      startingRollTagInput.value = state.startingRollTag || "";
      sessionTagInput.value = state.sessionTag || "";

      targetFlipsInput.value = state.targetFlips || "";
      profitPerFlipInput.value = state.profitPerFlip || "";

      updateDashboardStats();
      updateFlipsUI();
      updateJournal();
      updateVaultUIFromState();
    }

    initFromState();
  </script>
</body>
</html>
